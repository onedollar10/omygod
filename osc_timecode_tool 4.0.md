# OSC Absolute Timecode Tool 使用說明書 & 文件

## 專案概述

**OSC Absolute Timecode Tool** 是一個專業的音訊播放與時間碼同步工具。它專為燈光設計師與舞台技術人員打造，能讀取多種音訊格式 (MP3/WAV/OGG)，並透過 OSC (Open Sound Control) 協定與 ETC/EOS 系列燈控台進行深度的時間碼標註與同步。此外，它還能透過音訊介面輸出標準的 SMPTE LTC 時間碼。

---

## 核心功能

### 1. 播放清單與音訊管理
- **多檔案支援**: 可一次選取多個音訊檔案加入播放清單。
- **自動續播**: 當目前曲目結束，系統會自動切換並播放下一首。
- **清單管理**: 支援調整曲目順序（上移/下移）、刪除曲目。
- **獨立偏移量**: 每個曲目都可以設定專屬的 Timecode Offset (時間碼偏移量)，切換曲目時自動套用。

### 2. 精確播放控制
- **標準化外觀**: 所有控制按鈕統一尺寸，介面整潔。
- **重新排佈**: 按鈕順序優化為 `[Play] [⏮ 上一首] [⏭ 下一首] [Pause] [Stop]`，操作更直覺。
- **啟動最大化**: 程式開啟時自動以最大化視窗顯示。

### 3. 時間碼輸出與同步
- **OSC 通訊**:
  - 預設目標 IP 為 `127.0.0.1` (本機)，連接 Port 預設為 `8000`。
  - 支援發送 `/eos/cmd/Cue/{cue_number}/Time_Code/{timecode}/enter` 指令到 ETC 燈控台。
- **LTC 實體輸出 (新)**:
  - 透過音訊輸出裝置發送標準 SMPTE LTC 訊號。
  - 支援可變音量與裝置選擇。
  - 支援 24, 25, 30 FPS。

### 4. 視覺化波形與 Cue 標記
- **即時波形**: 自動分析音訊波形，支援縮放 (Zoom In/Out)。
- **快速跳轉**: 點擊波形任何位置即可精確定位播放點。
- **一鍵標記 (Mark Cue)**: 在播放過程中隨時按下，系統即刻發送目前時間碼至燈控台，並將該點記錄在 Cue Log 中。
- **圖形標示**: 在波形圖上以綠色線條標示已標記的 Cue 位置與編號。

### 5. Cue 資料管理
- **雙擊編輯**: 可隨時雙擊清單中的 Cue 記錄來更改編號或微調時間碼。
- **一鍵重發 (Resend All)**: 設定好 IP 與 Port 後，可一次將所有記錄好的 Cue 時間碼同步回燈控台。
- **匯入/匯出**: 支援將標記好的清單匯出為 CSV 檔，方便異地處理或存檔。

---

## 軟體使用說明書 (User Manual)

### 第一步：基礎設定
1. **設定燈控台連線**:
   - 在介面下方的 **ETC IP** 欄位輸入燈控台的 IP (若在同台電腦執行則使用預設的 `127.0.0.1`)。
   - 確認 **Port** 與燈控台上的 OSC 接收埠一致 (預設為 `8000`)。
2. **選擇 FPS**: 在設定區選擇您專案所使用的影格率 (24, 25 或 30)。

### 第二步：載入媒體
1. 點擊頂部的 **"Add Files to Playlist"** 按鈕。
2. 選取一個或多個音訊檔案 (WAV/MP3/OGG)。
3. 音訊會出現在右側的 **Playlist** 清單中。

### 第三步：時間碼校對
1. 若該曲目需要在特定的時間碼開始 (例如 01:00:00:00)，請在 **Track Offset** 欄位修改。
2. 切換 **"Conv. TC"** 開關，可以選擇送出「實際時間」或「轉換後的影格時間碼」。

### 第四步：標記 Cue 與同步
1. 按下 **Play** 開始播放。
2. 當音樂進行到需要下 Cue 的點，按下右側醒目的 **"Mark Cue"** 按鈕。
   - 燈控台會即時收到一條時間碼寫入訊息。
   - 左下角的 **Cue Log** 會多出一筆記錄。
3. 如果需要開啟 LTC 實體輸出，請打開 **"LTC Out"** 開關，並選擇正確的播放裝置。

### 第五步：清單整理與匯出
1. 錄製完成後，您可以檢查 **Cue Log**。
2. 如有錯誤，雙擊該行即可開啟編輯視窗。
3. 點擊 **"Export"** 將這份時碼清單存檔為 CSV 檔案。

---

## 技術說明與類別架構

### 主要模組
- `app.py`: 主應用程式邏輯與 GUI。
- `ltc_generator.py`: 負責 SMPTE 時間碼的數位編碼與即時音訊串流產生。

### 主要內部方法 (開發參考)
| 方法 | 說明 |
| --- | --- |
| `play_track(index)` | 切換並加載播放清單中指定索引的曲目。 |
| `update_time_display()` | 每 30ms 觸發一次，負責繪製播放頭與更新時碼顯示。 |
| `analyze_audio_data()` | 後台線程分析音訊，避免 UI 凍結。 |
| `resend_all_cues()` | 遍歷 Cue Log 並依序發送 OSC 指令。 |

---

## 介面佈局示意圖

```
┌───────────────────────────────────────────────────────────────┐
│ [Add Files to Playlist]  [目前播放曲目名稱...]                  │ ← 頂部功能區域
├─────────────────────────────────────────────┬─────────────────┤
│ [Play] [⏮] [⏭] [Pause] [Stop] | [Zoom -/+] │     Playlist    │
├─────────────────────────────────────────────┤                 │
│ Track Offset: [HH:MM:SS:ss]  FPS: [30▼] [TC]│      Tracks     │
├─────────────────────────────────────────────┤     [1. SongA]  │
│      Actual Time      │    Converted Time   │     [2. SongB]  │
│      00:00:00:00      │      00:00:00:00    │      (可移動)   │
├─────────────────────────────────────────────┤                 │
│ [▂▃▅▆ 波形視覺化區域 ▆▅▃▂]                   │     [Remove]    │
├─────────────────────────────────────────────┴─────────────────┤
│ ETC IP: [127.0.0.1]  Port: [8000]  Cue: [1]   [Mark Cue]      │
├───────────────────────────────┬───────────────────────────────┤
│            Cue Log            │           OSC Log             │
│ [Import] [Export] [Del] [Resend]│            (傳輸記錄)         │
└───────────────────────────────┴───────────────────────────────┘
```

## 安裝需求

請確保安裝以下 Python 套件：
```bash
pip install customtkinter python-osc librosa numpy sounddevice
```

## 注意事項
1. **防火牆**: 請確保 Windows 防火牆未阻擋 TCP/UDP 8000 埠口的 OSC 傳輸。
2. **取樣率**: LTC 輸出與音樂分析皆強制使用 48000Hz 以獲得最佳精度。
3. **音訊裝置**: 若要輸出 LTC，請務必手動選擇除了主喇叭以外的通道 (例如獨立聲卡)，以避免音樂與 LTC 混在一起。

---
**版本資訊**
- 版本: 4.0
- 更新日期: 2026-01-06
- 開發者: onedoller / Antigravity AI助手修改
